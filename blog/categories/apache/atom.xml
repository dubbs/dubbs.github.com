<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Apache | Kevin Warrington]]></title>
  <link href="http://dubbs.github.io/blog/categories/apache/atom.xml" rel="self"/>
  <link href="http://dubbs.github.io/"/>
  <updated>2014-09-11T11:15:48-06:00</updated>
  <id>http://dubbs.github.io/</id>
  <author>
    <name><![CDATA[Kevin Warrington]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Apache and or Nginx]]></title>
    <link href="http://dubbs.github.io/blog/2014/03/14/apache-and-or-nginx/"/>
    <updated>2014-03-14T23:54:00-06:00</updated>
    <id>http://dubbs.github.io/blog/2014/03/14/apache-and-or-nginx</id>
    <content type="html"><![CDATA[<h2>Apache</h2>

<p>Apache was designed to process web requests in a <strong>consistent</strong> and <strong>reliable</strong> manner.</p>

<p>It uses a <strong>process-driven</strong> architecture and handles one connection per-process or per-thread.</p>

<p>Apache comes with 2 multi processing modules (MPM), which bind to ports, accept requests and spawn processes:</p>

<ol>
<li><p><strong>Prefork</strong> MPM</p>

<p> Uses multiple child processes with one thread each.
 Each process handles one connection at a time.</p></li>
<li><p><strong>Worker</strong> MPM</p>

<p> Uses multiple child processes with many threads each.
 Each thread handles one connection at a time.
 If you want to use mod_php (not thread safe), it is recommended that you also use FastCGI, so that php is running in its own memory space.</p></li>
</ol>


<p>Apache does not scale well under high server load, often consuming large amounts of RAM and CPU.</p>

<p>With Apache, it is easy to configure complex setups, it has excellent documentation and abundant module availability.</p>

<h2>Nginx</h2>

<p>Nginx was designed to solve the <a href="https://en.wikipedia.org/wiki/C10k_problem">c10k problem</a>, and as a result, is a highly performant http and reverse proxy server.</p>

<p>It uses an <strong>event-driven</strong> architecture and handles multiple connections
in a single event loop.</p>

<p>Nginx is very good at serving <em>static content</em>, which accounts for 80 - 95% of website requests.
It scales very well under high server load, and is not dependent on the underlying server hardware.</p>

<p>Compared to other more established web servers,
complex site configuration is typically more difficult with Nginx,
due to lightweight design.  It also lacking in documentation and module support.</p>

<p>Some notable sites using Nginx include:</p>

<ul>
<li>github</li>
<li>wordpress</li>
<li>pinterest</li>
<li>netflix</li>
<li>cloudflare</li>
</ul>


<h2>Both?</h2>

<p>Nginx can be used as a reverse proxy, in front of Apache, handling all
requests for static content.  All other requests are forwarded to
Apache via <code>proxypass</code>.  You will need to install mod_rpaf, so
Apache can pick up the <code>X-Real-IP</code> header provided by nginx.  This will make
it seem as though Apache handled the original request.</p>

<!--
http://www.stderr.net/apache/rpaf/
http://serverfault.com/questions/273260/when-should-i-switch-to-nginx
http://www.inetu.net/about/server-smarts-blog/january-2013/nginx-vs-apache-which-web-server-is-right-for-your
 -->

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Forward vs Reverse Proxy Using Apache]]></title>
    <link href="http://dubbs.github.io/blog/2013/09/23/forward-vs-reverse-proxy-using-apache/"/>
    <updated>2013-09-23T13:09:00-06:00</updated>
    <id>http://dubbs.github.io/blog/2013/09/23/forward-vs-reverse-proxy-using-apache</id>
    <content type="html"><![CDATA[<p>A proxy server acts as an intermediary between a client and a destination server, primarily controlling access to resources and caching content.</p>

<p>To enable proxy functionality in Apache, use the following:</p>

<pre><code># /etc/apache2/httpd.conf
LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_http_module modules/mod_proxy_http.so
</code></pre>

<h2>Forward Proxy</h2>

<p>A <a href="http://en.wikipedia.org/wiki/Proxy_server#Forward_proxies">Forward Proxy</a> is typically used to:</p>

<ul>
<li>hide the identities of clients</li>
<li>provide internet access to clients blocked by firewall</li>
<li>cache content to reduce network traffic</li>
</ul>


<p>A forward proxy accepts requests from internal clients and forwards them to an external resource.</p>

<p><img src="/images/forward-proxy.png"></p>

<p>To configure this in Apache, we can simply control who has access to external resources by
specifying their IP address.</p>

<pre><code>&lt;VirtualHost *:80&gt;
  # Enables Apache to acting as forwarding server
  ProxyRequests On

  # Adds Via header to requests
  ProxyVia On

  &lt;Proxy *&gt;
    Order deny,allow
    Deny from all

    # Only allows this client to proxy requests
    Allow from 192.168.0.11
  &lt;/Proxy&gt;
&lt;/VirtualHost&gt;
</code></pre>

<h2>Reverse Proxy</h2>

<p>A <a href="http://en.wikipedia.org/wiki/Reverse_proxy">Reverse proxy</a> is typically used to:</p>

<ul>
<li>hide the identities of servers</li>
<li>act as load balancer</li>
<li>act as web accelerator</li>
<li>used to perform A/B testing</li>
</ul>


<p>A reverse proxy accepts requests from external clients and usually forwards them
to an internal resource.</p>

<p><img src="/images/reverse-proxy.png"></p>

<p>To configure this in Apache, we use the <code>ProxyPass</code> and <code>ProxyPassReverse</code> directives.</p>

<pre><code>&lt;VirtualHost *:80&gt;
  # Prevents Apache from acting as forwarding server
  ProxyRequests Off

  # http://example.com/assets/css to be internally converted into a proxy request to http://cdn.example.com/css
  ProxyPass /assets/ http://cdn.example.com/

  # if http://cdn.example.com/css has a redirect to http://cdn.example.com/v2/css
  # Apache will adjust the request to http://example.com/assets/v2/css before forwarding response
  ProxyPassReverse /assets/ http://cdn.example.com/
&lt;/VirtualHost&gt;
</code></pre>
]]></content>
  </entry>
  
</feed>
